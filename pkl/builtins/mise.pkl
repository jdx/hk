import "../Builtins.pkl"
import "../Config.pkl"
import "./test/helpers.pkl"

@Builtins.meta {
  category = "Infrastructure"
  description = "mise-en-place's built-in formatter and linter"
}
mise = new Config.Step {
  glob =
    List(
      "mise.toml",
      "mise.*.toml",
      ".mise.toml",
      ".mise.*.toml",
      "mise/config.toml",
      "mise/config.*.toml",
      ".mise/config.toml",
      ".mise/config.*.toml",
      ".config/mise.toml",
      ".config/mise.*.toml",
      ".config/mise/config.toml",
      ".config/mise/config.*.toml",
      ".config/mise/mise.toml",
      ".config/mise/mise.*.toml",
      ".config/mise/conf.d/*.toml",
    )
  batch = true
  check = "mise fmt --check"
  fix = "mise fmt"
  tests {
    ...new helpers.Fix {
      filename = "mise.toml"
      before = "x  =  1"
      after = "x = 1\n"
    }.suite
  }
}
