import "../Builtins.pkl"
import "../Config.pkl"

@Builtins.meta {
    category = "Data Formats"
    description = "TOML linter"
}
taplo = new Config.Step {
    glob = "**/*.toml"
    check = "taplo lint {{ files }}"
    tests {
        ["check bad file"] {
            run = "check"
            write { ["{{tmp}}/file.toml"] = "[table]\nkey = 0\nkey = 1\n" }
            files = List("{{tmp}}/file.toml")
            expect { code = 1 }
        }
        ["check good file"] {
            run = "check"
            write { ["{{tmp}}/file.toml"] = "[table]\nkey = 0\n" }
            files = List("{{tmp}}/file.toml")
            expect { code = 0 }
        }
        ["doesnt error on formattting"] {
            run = "check"
            write { ["{{tmp}}/file.toml"] = "[table]\nkey   =   0\n" }
            files = List("{{tmp}}/file.toml")
            expect { code = 0 }
        }
    }
}
