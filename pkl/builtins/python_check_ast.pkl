import "../Config.pkl"

python_check_ast = new Config.Step {
    glob = "*.py"
    check = "hk util python-check-ast {{files}}"
    tests {
        ["detects invalid Python syntax"] {
            run = "check"
            write {
                ["{{tmp}}/invalid.py"] = """
                    def hello(:
                        print("Invalid"
                    """
            }
            files = List("{{tmp}}/invalid.py")
            expect { code = 1 }
        }
        ["passes valid Python"] {
            run = "check"
            write {
                ["{{tmp}}/valid.py"] = """
                    def hello():
                        print("Hello, world!")
                    """
            }
            files = List("{{tmp}}/valid.py")
            expect { code = 0 }
        }
        ["passes empty file"] {
            run = "check"
            write {
                ["{{tmp}}/empty.py"] = ""
            }
            files = List("{{tmp}}/empty.py")
            expect { code = 0 }
        }
    }
}
