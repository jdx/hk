import "../Builtins.pkl"
import "../Config.pkl"
import "./test/helpers.pkl"

@Builtins.meta {
  category = "Data Formats"
  description = "YAML formatter"
}
yamlfmt = new Config.Step {
  glob = List("**/*.yml", "**/*.yaml")
  stage = "<JOB_FILES>"
  check_diff = "yamlfmt -lint {{ files }}"
  fix = "yamlfmt {{ files }}"
  tests {
    ...new helpers.Fix {
      filename = "test.yaml"
      before = "-  a\n"
      after = "- a\n"
      extra_files = new Mapping<String, String> {
        ["yamlfmt.yaml"] =
          """
            formatter:
              type: basic
          """
      }
    }.suite
  }
}
