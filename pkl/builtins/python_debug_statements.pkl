import "../Config.pkl"

python_debug_statements = new Config.Step {
    glob = "*.py"
    check = "hk util python-debug-statements {{files}}"
    tests {
        ["detects pdb"] {
            run = "check"
            write {
                ["{{tmp}}/with_pdb.py"] = """
                    import pdb
                    pdb.set_trace()
                    """
            }
            files = List("{{tmp}}/with_pdb.py")
            expect { code = 1 }
        }
        ["detects breakpoint"] {
            run = "check"
            write {
                ["{{tmp}}/with_breakpoint.py"] = """
                    def debug():
                        breakpoint()
                    """
            }
            files = List("{{tmp}}/with_breakpoint.py")
            expect { code = 1 }
        }
        ["passes clean code"] {
            run = "check"
            write {
                ["{{tmp}}/clean.py"] = """
                    def hello():
                        print("Hello, world!")
                    """
            }
            files = List("{{tmp}}/clean.py")
            expect { code = 0 }
        }
        ["ignores commented debug"] {
            run = "check"
            write {
                ["{{tmp}}/commented.py"] = """
                    def hello():
                        # import pdb; pdb.set_trace()
                        print("Hello")
                    """
            }
            files = List("{{tmp}}/commented.py")
            expect { code = 0 }
        }
    }
}
