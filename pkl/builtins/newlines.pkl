import "../Builtins.pkl"
import "../Config.pkl"

@Builtins.meta {
    category = "Special Purpose"
    description = "Ensure files end with newline"
}
newlines = new Config.Step {
    glob = "**/*"
    stage = "<JOB_FILES>"
    check_first = true
    check_list_files = "hk util end-of-file-fixer {{files}}"
    fix = "hk util end-of-file-fixer --fix {{files}}"
    tests {
      ["adds newline"] {
        run = "fix"
        write { ["{{tmp}}/a.txt"] = "no-newline" }
        files = List("{{tmp}}/a.txt")
        expect { files { ["{{tmp}}/a.txt"] = "no-newline\n" } }
      }
    }
}
