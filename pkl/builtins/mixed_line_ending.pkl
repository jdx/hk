import "../Builtins.pkl"
import "../Config.pkl"
import "./test/helpers.pkl"

@Builtins.meta {
  category = "Special Purpose"
  description = "Detect and fix mixed line endings"
}
mixed_line_ending = new Config.Step {
  glob = "**/*"
  stage = "<JOB_FILES>"
  check = "hk util mixed-line-ending {{files}}"
  fix = "hk util mixed-line-ending --fix {{files}}"
  tests {
    ...new helpers.Fix {
      filename = "test.txt"
      before = "line1\r\nline2\nline3\r\n"
      // NB: Also tests "passes LF only"
      after = "line1\nline2\nline3\n"
      other_good = new Mapping<String, String> {
        ["passes CRLF only"] = "line1\r\nline2\r\nline3\r\n"
      }
    }.suite
  }
}
